<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>UFO 피하기 게임</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        background: linear-gradient(to bottom, #000428, #004e92);
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        font-family: "Courier New", monospace;
        color: white;
      }

      #gameContainer {
        position: relative;
        border: 3px solid #fff;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
      }

      #gameCanvas {
        display: block;
        background: linear-gradient(to bottom, #001122, #003366);
      }

      #ui {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 20px;
        font-weight: bold;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      }

      #instructions {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        font-size: 18px;
        line-height: 1.6;
        background: rgba(0, 0, 0, 0.7);
        padding: 20px;
        border-radius: 10px;
        border: 2px solid #fff;
      }

      #gameOver {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        font-size: 24px;
        background: rgba(255, 0, 0, 0.8);
        padding: 30px;
        border-radius: 10px;
        border: 3px solid #fff;
        display: none;
      }

      .blink {
        animation: blink 1s infinite;
      }

      @keyframes blink {
        0%,
        50% {
          opacity: 1;
        }
        51%,
        100% {
          opacity: 0.3;
        }
      }
    </style>
  </head>
  <body>
    <div id="gameContainer">
      <canvas id="gameCanvas" width="800" height="600"></canvas>
      <div id="ui">⌛️생존시간: <span id="timer">0</span>초</div>
      <div id="instructions">
        <h2>🛸 UFO 피하기 게임 🛸</h2>
        <p><strong>PC:</strong> ← → 방향키로 이동</p>
        <p><strong>모바일:</strong> 화면 좌우 터치로 이동</p>
        <p class="blink">스페이스바 또는 터치로 시작!</p>
      </div>
      <div id="gameOver">
        <h2>💥 GAME OVER 💥</h2>
        <p>생존시간: <span id="finalTime">0</span>초</p>
        <p class="blink">스페이스바 또는 터치로 재시작!</p>
      </div>
    </div>

    <script>
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");
      const timerElement = document.getElementById("timer");
      const instructionsElement = document.getElementById("instructions");
      const gameOverElement = document.getElementById("gameOver");
      const finalTimeElement = document.getElementById("finalTime");

      let gameState = "waiting"; // 'waiting', 'playing', 'gameOver'
      let gameStartTime = 0;
      let survivalTime = 0;
      let lastTime = 0;

      // UFO 설정
      const ufo = {
        x: canvas.width / 2,
        y: canvas.height - 80,
        width: 40,
        height: 20,
        speed: 5,
      };

      // 운석 배열
      let meteors = [];

      // UFO 도트맵 (반원형)
      const ufoPixelMap = [
        [0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0],
        [0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0],
        [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0],
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
        [1, 1, 1, 2, 1, 1, 2, 1, 1, 2, 1, 1, 2, 1], // 2는 라이트
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
      ];

      // 운석 생성
      function createMeteor() {
        return {
          x: Math.random() * (canvas.width - 20),
          y: -20,
          width: 15,
          height: 15,
          speed: Math.random() * 3 + 2,
        };
      }

      // UFO 그리기 (도트맵으로)
      function drawUFO() {
        const pixelSize = 3;
        const startX = ufo.x - (ufoPixelMap[0].length * pixelSize) / 2;
        const startY = ufo.y - (ufoPixelMap.length * pixelSize) / 2;

        for (let row = 0; row < ufoPixelMap.length; row++) {
          for (let col = 0; col < ufoPixelMap[row].length; col++) {
            const pixelValue = ufoPixelMap[row][col];
            if (pixelValue === 1) {
              ctx.fillStyle = "#silver";
              ctx.fillRect(
                startX + col * pixelSize,
                startY + row * pixelSize,
                pixelSize,
                pixelSize
              );
            } else if (pixelValue === 2) {
              ctx.fillStyle = "#00ff00";
              ctx.fillRect(
                startX + col * pixelSize,
                startY + row * pixelSize,
                pixelSize,
                pixelSize
              );
            }
          }
        }
      }

      // 운석 그리기 (도트 스타일)
      function drawMeteor(meteor) {
        const pixelSize = 2;
        ctx.fillStyle = "#ff4444";

        // 운석 패턴
        const meteorPattern = [
          [0, 1, 1, 0],
          [1, 1, 1, 1],
          [1, 1, 1, 1],
          [0, 1, 1, 0],
        ];

        for (let row = 0; row < meteorPattern.length; row++) {
          for (let col = 0; col < meteorPattern[row].length; col++) {
            if (meteorPattern[row][col] === 1) {
              ctx.fillRect(
                meteor.x + col * pixelSize,
                meteor.y + row * pixelSize,
                pixelSize,
                pixelSize
              );
            }
          }
        }
      }

      // 별 그리기 (배경)
      function drawStars() {
        ctx.fillStyle = "#ffffff";
        for (let i = 0; i < 50; i++) {
          const x = (i * 47 + lastTime * 0.01) % canvas.width;
          const y = (i * 37 + lastTime * 0.02) % canvas.height;
          ctx.fillRect(x, y, 1, 1);
        }
      }

      // 충돌 감지
      function checkCollision(rect1, rect2) {
        return (
          rect1.x < rect2.x + rect2.width &&
          rect1.x + rect1.width > rect2.x &&
          rect1.y < rect2.y + rect2.height &&
          rect1.y + rect1.height > rect2.y
        );
      }

      // 게임 업데이트
      function update(currentTime) {
        if (gameState !== "playing") return;

        // 생존 시간 업데이트
        survivalTime = Math.floor((currentTime - gameStartTime) / 1000);
        timerElement.textContent = survivalTime;

        // 운석 생성 (난이도 증가)
        const meteorSpawnRate = Math.max(0.02, 0.05 - survivalTime * 0.001);
        if (Math.random() < meteorSpawnRate) {
          meteors.push(createMeteor());
        }

        // 운석 업데이트
        meteors.forEach((meteor, index) => {
          meteor.y += meteor.speed;

          // 화면 밖으로 나간 운석 제거
          if (meteor.y > canvas.height) {
            meteors.splice(index, 1);
          }

          // UFO와 충돌 체크
          if (checkCollision(ufo, meteor)) {
            gameState = "gameOver";
            finalTimeElement.textContent = survivalTime;
            gameOverElement.style.display = "block";
          }
        });
      }

      // 게임 렌더링
      function render() {
        // 화면 클리어
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 배경 별 그리기
        drawStars();

        if (gameState === "playing") {
          // UFO 그리기
          drawUFO();

          // 운석들 그리기
          meteors.forEach(drawMeteor);
        }
      }

      // 게임 루프
      function gameLoop(currentTime) {
        update(currentTime);
        render();
        lastTime = currentTime;
        requestAnimationFrame(gameLoop);
      }

      // 게임 시작
      function startGame() {
        gameState = "playing";
        gameStartTime = performance.now();
        survivalTime = 0;
        meteors = [];
        ufo.x = canvas.width / 2;
        instructionsElement.style.display = "none";
        gameOverElement.style.display = "none";
      }

      // 게임 리셋
      function resetGame() {
        gameState = "waiting";
        instructionsElement.style.display = "block";
        gameOverElement.style.display = "none";
      }

      // 키보드 이벤트
      document.addEventListener("keydown", (e) => {
        if (e.code === "Space") {
          e.preventDefault();
          if (gameState === "waiting" || gameState === "gameOver") {
            startGame();
          }
        }

        if (gameState === "playing") {
          if (e.code === "ArrowLeft") {
            ufo.x = Math.max(20, ufo.x - ufo.speed);
          } else if (e.code === "ArrowRight") {
            ufo.x = Math.min(canvas.width - 20, ufo.x + ufo.speed);
          }
        }
      });

      // 터치 이벤트 (모바일)
      canvas.addEventListener("touchstart", (e) => {
        e.preventDefault();

        if (gameState === "waiting" || gameState === "gameOver") {
          startGame();
          return;
        }

        if (gameState === "playing") {
          const touch = e.touches[0];
          const rect = canvas.getBoundingClientRect();
          const touchX = touch.clientX - rect.left;

          if (touchX < canvas.width / 2) {
            ufo.x = Math.max(20, ufo.x - ufo.speed * 2);
          } else {
            ufo.x = Math.min(canvas.width - 20, ufo.x + ufo.speed * 2);
          }
        }
      });

      // 연속 키 입력 처리
      const keys = {};
      document.addEventListener("keydown", (e) => {
        keys[e.code] = true;
      });

      document.addEventListener("keyup", (e) => {
        keys[e.code] = false;
      });

      // 연속 이동 처리
      function handleContinuousInput() {
        if (gameState === "playing") {
          if (keys["ArrowLeft"]) {
            ufo.x = Math.max(20, ufo.x - ufo.speed);
          }
          if (keys["ArrowRight"]) {
            ufo.x = Math.min(canvas.width - 20, ufo.x + ufo.speed);
          }
        }
      }

      // 연속 입력 처리를 위한 별도 루프
      setInterval(handleContinuousInput, 16);

      // 게임 시작
      gameLoop(0);
    </script>
  </body>
</html>
